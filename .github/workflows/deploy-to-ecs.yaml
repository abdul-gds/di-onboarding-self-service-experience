name: Deploy to ECS
run-name: Deploy to ECS [${{ github.head_ref || github.ref_name }}]

on: push

defaults:
  run:
    shell: bash
    working-directory: ./
    
permissions: read-all

jobs:
  build-front-app:
    name: Build
    uses: ./.github/workflows/build-front-app.yml

  deploy-front-app:
    name: Deploy
    needs: build-front-app
    uses: ./.github/workflows/deploy-to-fargate.yml
    permissions:
      id-token: write
      contents: read
    with:
      environment: development
    secrets:
      aws-role-arn: ${{ secrets.SSE_GHA_ROLE_ARN }}
      ecs-task-role-arn: ${{ secrets.SSE__GHA_ROLE_ARN }}
      ecs-execution-role-arn: ${{ secrets.SSE__GHA_ROLE_ARN }}
